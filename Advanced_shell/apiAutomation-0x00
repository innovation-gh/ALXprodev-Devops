#!/bin/bash

# API Request Automation - Task 0
# Fetches Pikachu data from Pokemon API and saves to data.json

API_URL="https://pokeapi.co/api/v2/pokemon/pikachu"
OUTPUT_FILE="data.json"
ERROR_FILE="errors.txt"

echo "Fetching Pikachu data from Pokemon API..."

# Make API request and save response
if curl -s -o "$OUTPUT_FILE" "$API_URL"; then
    # Check if the file was created and has content
    if [[ -f "$OUTPUT_FILE" && -s "$OUTPUT_FILE" ]]; then
        # Check if the response is valid JSON and not an error page
        if jq . "$OUTPUT_FILE" > /dev/null 2>&1; then
            echo "✅ Successfully saved Pikachu data to $OUTPUT_FILE"
        else
            echo "❌ Invalid JSON response received" | tee -a "$ERROR_FILE"
            echo "Response content:" >> "$ERROR_FILE"
            head -10 "$OUTPUT_FILE" >> "$ERROR_FILE"
            echo "---" >> "$ERROR_FILE"
            exit 1
        fi
    else
        echo "❌ No data received from API" | tee -a "$ERROR_FILE"
        echo "Error occurred at: $(date)" >> "$ERROR_FILE"
        exit 1
    fi
else
    echo "❌ Failed to fetch data from API" | tee -a "$ERROR_FILE"
    echo "Error occurred at: $(date)" >> "$ERROR_FILE"
    exit 1
fi